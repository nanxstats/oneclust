<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maximum Homogeneity Clustering for One-Dimensional Data • oneclust</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Maximum Homogeneity Clustering for One-Dimensional Data">
<meta property="og:description" content="oneclust">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oneclust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/oneclust.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanxstats/oneclust/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="oneclust_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Maximum Homogeneity Clustering for One-Dimensional Data</h1>
                        <h4 class="author">Nan Xiao &lt;<a href="https://nanx.me" class="uri">https://nanx.me</a>&gt;</h4>
            
            <h4 class="date">2020-08-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nanxstats/oneclust/blob/master/vignettes/oneclust.Rmd"><code>vignettes/oneclust.Rmd</code></a></small>
      <div class="hidden name"><code>oneclust.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>oneclust</code> package implements the maximum homogeneity clustering (partitioning) method for univariate data described in <span class="citation">Fisher (1958)</span> via dynamic programming. Given a one-dimensional numerical vector <span class="math inline">\((a_1, a_2, \ldots, a_n)\)</span>, a weight vector <span class="math inline">\((w_1, w_2, \ldots, w_n)\)</span>, and a positive integer <span class="math inline">\(k &lt; n\)</span>, the algorithm seeks to minimize</p>
<p><span class="math display">\[
D = \sum_{i = 1}^{n} w_i (a_i - \bar{a_i})^2
\]</span></p>
<p>when each <span class="math inline">\(a_i\)</span> is assigned into <span class="math inline">\(k\)</span> clusters. <span class="math inline">\(\bar{a_i}\)</span> is the weighted mean of the cluster that <span class="math inline">\(a_i\)</span> belongs to. Fisher proved that the optimal partitions have to be <em>contiguous</em> when the data can be sorted. Contiguous means for <span class="math inline">\(i &lt; j &lt; k\)</span>, if <span class="math inline">\(a_i\)</span> and <span class="math inline">\(a_k\)</span> are assigned to the same cluster, then <span class="math inline">\(a_j\)</span> must also be assigned to the same cluster — otherwise the partition would be suboptimal. This fact leads to a substantially reduced number of possible partitions and dynamic programming solutions.</p>
<p>Intuitively, maximum homogeneity clustering can be used to smooth the data and reveal its structures. It has some potential applications in data pre-processing and post-processing in statistical machine learning.</p>
</div>
<div id="feature-engineering-for-high-cardinality-categorical-features" class="section level1">
<h1 class="hasAnchor">
<a href="#feature-engineering-for-high-cardinality-categorical-features" class="anchor"></a>Feature engineering for high-cardinality categorical features</h1>
<p>Categorical features with high cardinality or rare levels pose a common challenge when building certain types of supervised learning models. For example, classification trees might only be able to handle a limited number of levels in categorical predictors, because a binary node split on a categorical feature with <span class="math inline">\(l\)</span> levels means finding one from <span class="math inline">\(2^{l-1}\)</span> possible combinations thus computationally intractable.</p>
<p>To tackle this problem, <span class="citation">Breiman et al. (1984)</span> discussed splitting a categorical feature into two subsets when the response is binary, and generalized Fisher’s result to arbitrary convex node impurity functions. Lightgbm <span class="citation">(Ke et al. 2017)</span> <a href="https://lightgbm.readthedocs.io/en/latest/Features.html#optimal-split-for-categorical-features">employs this method</a> to find the optimal split by sorting the histogram based on the training objective. As such, besides one-hot encoding and hashing, recoding high-cardinality categorical features with histogram sorting and maximum homogeneity partitioning could be a viable feature engineering strategy in practice. The application is also not limited to tree models.</p>
<div id="simulated-postal-code-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-postal-code-data" class="anchor"></a>Simulated postal code data</h2>
<p>In this section, we simulate a high-cardinality variable with a binary response. The key assumption here is: the probabilities of having which response correlate to the size of the level. After the data is generated, we use maximum homogeneity clustering on the (sorted) histogram of the categorical variable. Our goal is to verify if the clustering results can uncover this level size structure and potentially help the classification modeling later. This example is derived from the “rare levels” vignette in the <code>vtreat</code> package <span class="citation">(Zumel and Mount 2016)</span>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"oneclust"</span>)</pre></body></html></div>
<p>Generate a training set and an independent test set:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">df_levels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_postcode_levels.html">sim_postcode_levels</a></span>(<span class="kw">nlevels</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">42</span>)
<span class="no">train</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_postcode_samples.html">sim_postcode_samples</a></span>(<span class="no">df_levels</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">100000</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">3000</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">43</span>)
<span class="no">test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_postcode_samples.html">sim_postcode_samples</a></span>(<span class="no">df_levels</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">100000</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">3000</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">44</span>)</pre></body></html></div>
<p>The categorical variable has 500 (unique) levels of postal codes. The training and test set each has 100,000 samples. The level size follows a log normal distribution <span class="math inline">\(LN(\log(4000), 1)\)</span>. For postal code levels with fewer than 3,000 samples, they are defined as “rare levels” and has a probability of 0.2 to get response label 1. Otherwise, the level has a probability of 0.1 of getting response label 1. The rest of the samples will get a response label 0.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_levels</span>)</pre></body></html></div>
<pre><code>##    size postcode
## 1 15756   z04113
## 2  2274   z04578
## 3  5751   z02580
## 4  7532   z01457
## 5  5993   z03546
## 6  3597   z04056</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">train</span>)</pre></body></html></div>
<pre><code>##   postcode label is_rare
## 1   z04546     0   FALSE
## 2   z03223     0   FALSE
## 3   z01687     0   FALSE
## 4   z01301     0    TRUE
## 5   z00848     0   FALSE
## 6   z03046     0   FALSE</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">test</span>)</pre></body></html></div>
<pre><code>##   postcode label is_rare
## 1   z01482     1   FALSE
## 2   z03825     1   FALSE
## 3   z02533     0   FALSE
## 4   z03640     1   FALSE
## 5   z01608     1   FALSE
## 6   z02130     0   FALSE</code></pre>
</div>
<div id="recode-the-training-set" class="section level2">
<h2 class="hasAnchor">
<a href="#recode-the-training-set" class="anchor"></a>Recode the training set</h2>
<p>For the training set, we cluster the postal codes into 32 clusters by the size of each level (histogram):</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">k</span> <span class="kw">&lt;-</span> <span class="fl">32</span>
<span class="no">level_hist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">train</span>$<span class="no">postcode</span>)
<span class="no">level_new</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/oneclust.html">oneclust</a></span>(<span class="no">level_hist</span>, <span class="no">k</span>)$<span class="no">cluster</span>
<span class="no">feature_tr</span> <span class="kw">&lt;-</span> <span class="no">level_new</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">train</span>$<span class="no">postcode</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">level_hist</span>))] <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="no">k</span>))</pre></body></html></div>
<p>The postal codes belong to the first five clusters have a higher probability (approximately 0.2) of getting label 1. The other clusters have a lower probability (around 0.1) of getting label 1:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">las</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">feature_tr</span>, <span class="no">train</span>$<span class="no">label</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Cluster"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Label"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fl">2</span>))</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We can also verify that the number of the samples in the first five clusters is close to the actual number of samples in the “rare levels”:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">train</span>$<span class="no">is_rare</span>)</pre></body></html></div>
<pre><code>## [1] 10496</code></pre>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">feature_tr</span>)[<span class="fl">1</span>:<span class="fl">5</span>])</pre></body></html></div>
<pre><code>## [1] 9693</code></pre>
<p>When the specified number of clusters <span class="math inline">\(k\)</span> is smaller, the results might not be as good though.</p>
</div>
<div id="recode-the-test-set" class="section level2">
<h2 class="hasAnchor">
<a href="#recode-the-test-set" class="anchor"></a>Recode the test set</h2>
<p>In practice, we should encode the postal codes in the test set with the same cluster labels as we used in the training set, so that the classification models can be correctly applied to the test set.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">feature_te</span> <span class="kw">&lt;-</span> <span class="no">level_new</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">test</span>$<span class="no">postcode</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">level_hist</span>))] <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="no">k</span>))</pre></body></html></div>
<p>Check if the recoded variable has the similar label pattern:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">las</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">feature_te</span>, <span class="no">test</span>$<span class="no">label</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Cluster"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Label"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fl">2</span>))</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">test</span>$<span class="no">is_rare</span>)</pre></body></html></div>
<pre><code>## [1] 10610</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">feature_te</span>)[<span class="fl">1</span>:<span class="fl">5</span>])</pre></body></html></div>
<pre><code>## [1] 9883</code></pre>
</div>
</div>
<div id="grouping-coefficients-in-regression-models" class="section level1">
<h1 class="hasAnchor">
<a href="#grouping-coefficients-in-regression-models" class="anchor"></a>Grouping coefficients in regression models</h1>
<p>Besides sparsity and other properties, the <em>homogeneity</em> of the estimated coefficients in linear regressions is an important property — meaning certain groups of variables should be encouraged to share the same coefficients <span class="citation">(Ke, Fan, and Wu 2015)</span>. The source of homogeneity could be attributed to the systematic similarities between variables, for example, financial assets that belong to the same sector, or sets of adjacent variables with strong spatial correlation <span class="citation">(Lin et al. 2017)</span>.</p>
<div id="simulated-regression-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-regression-data" class="anchor"></a>Simulated regression data</h2>
<p>We use an fused lasso regression model on simulated data to illustrate the potential application in post-processing the coefficients. The example is derived from the vignette in the <code>genlasso</code> package <span class="citation">(Tibshirani, Taylor, and others 2011)</span>.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">100</span>
<span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="no">n</span>
<span class="no">y</span> <span class="kw">&lt;-</span> (<span class="no">i</span> <span class="kw">&gt;</span> <span class="fl">20</span> <span class="kw">&amp;</span> <span class="no">i</span> <span class="kw">&lt;</span> <span class="fl">30</span>) + <span class="fl">5</span> * (<span class="no">i</span> <span class="kw">&gt;</span> <span class="fl">50</span> <span class="kw">&amp;</span> <span class="no">i</span> <span class="kw">&lt;</span> <span class="fl">70</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">0.1</span>)</pre></body></html></div>
</div>
<div id="raw-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#raw-estimates" class="anchor"></a>Raw estimates</h2>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">out</span> <span class="kw">&lt;-</span> <span class="kw pkg">genlasso</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/genlasso/man/fusedlasso.html">fusedlasso1d</a></span>(<span class="no">y</span>)</pre></body></html></div>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">beta1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">out</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">1.5</span>)$<span class="no">beta</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">beta1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="soft-thresholding" class="section level2">
<h2 class="hasAnchor">
<a href="#soft-thresholding" class="anchor"></a>Soft-thresholding</h2>
<p>We can use soft-thresholding to transform the raw coefficient estimates into zero and non-zero values:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">beta2</span> <span class="kw">&lt;-</span> <span class="kw pkg">genlasso</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/genlasso/man/softthresh.html">softthresh</a></span>(<span class="no">out</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">1.5</span>, <span class="kw">gamma</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">grp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">beta2</span> <span class="kw">!=</span> <span class="fl">0</span>) + <span class="fl">1L</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">beta2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="no">grp</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topleft"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Zero"</span>, <span class="st">"Non-zero"</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">grp</span>)), <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="clustering-k-2" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-k-2" class="anchor"></a>Clustering (k = 2)</h2>
<p>We can also use the maximum homogeneity clustering method to group the coefficients into two clusters:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">cl1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/oneclust.html">oneclust</a></span>(<span class="no">beta1</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">cluster</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">beta1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="no">cl1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topleft"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Cluster"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl1</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl1</span>)), <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div id="clustering-k-3" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-k-3" class="anchor"></a>Clustering (k = 3)</h2>
<p>If needed, we can increase <span class="math inline">\(k\)</span> to get more groups of coefficients:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">cl2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/oneclust.html">oneclust</a></span>(<span class="no">beta1</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">3</span>)$<span class="no">cluster</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">beta1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="no">cl2</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topleft"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Cluster"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl2</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl2</span>)), <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
<div id="time-series-peak-calling" class="section level1">
<h1 class="hasAnchor">
<a href="#time-series-peak-calling" class="anchor"></a>Time series peak calling</h1>
<p>For time series data, the algorithm might be useful for calling peaks.</p>
<div id="simulated-time-series-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-time-series-data" class="anchor"></a>Simulated time series data</h2>
<p>We use an example from <code><a href="https://rdrr.io/pkg/pracma/man/findpeaks.html">pracma::findpeaks()</a></code>:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="kw">len</span> <span class="kw">=</span> <span class="fl">1024</span>)
<span class="no">pos</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.13</span>, <span class="fl">0.15</span>, <span class="fl">0.23</span>, <span class="fl">0.25</span>, <span class="fl">0.40</span>, <span class="fl">0.44</span>, <span class="fl">0.65</span>, <span class="fl">0.76</span>, <span class="fl">0.78</span>, <span class="fl">0.81</span>)
<span class="no">hgt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">4.2</span>, <span class="fl">2.1</span>, <span class="fl">4.3</span>, <span class="fl">3.1</span>, <span class="fl">5.1</span>, <span class="fl">4.2</span>)
<span class="no">wdt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>, <span class="fl">0.006</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.005</span>, <span class="fl">0.008</span>, <span class="fl">0.005</span>)

<span class="no">psignal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>))
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span> <span class="kw">=</span> <span class="no">pos</span>)) {
  <span class="no">psignal</span> <span class="kw">&lt;-</span> <span class="no">psignal</span> + <span class="no">hgt</span>[<span class="no">i</span>] / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>((<span class="no">x</span> - <span class="no">pos</span>[<span class="no">i</span>]) / <span class="no">wdt</span>[<span class="no">i</span>]))^<span class="fl">4</span>
}

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">psignal</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div id="clustering-k-2-1" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-k-2-1" class="anchor"></a>Clustering (k = 2)</h2>
<p>Group the signal into two clusters:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/oneclust.html">oneclust</a></span>(<span class="no">psignal</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">psignal</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"h"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="no">cl</span>$<span class="no">cluster</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Cluster"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl</span>$<span class="no">cluster</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl</span>$<span class="no">cluster</span>)), <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Cluster 2 covers the peak locations — the method did not specify a single data point as the peak, instead, it finds intervals.</p>
</div>
<div id="clustering-k-4" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-k-4" class="anchor"></a>Clustering (k = 4)</h2>
<p>If we increase <span class="math inline">\(k\)</span>, there will be fewer intervals included in the peak cluster (Cluster 4), with narrower peak intervals:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/oneclust.html">oneclust</a></span>(<span class="no">psignal</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">psignal</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"h"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="no">cl</span>$<span class="no">cluster</span> + <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Cluster"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl</span>$<span class="no">cluster</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cud.html">cud</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">cl</span>$<span class="no">cluster</span> + <span class="fl">2</span>)), <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="oneclust_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>One may also use the parameter <code>w</code> in <code><a href="../reference/oneclust.html">oneclust()</a></code> to use the weighted version of the algorithm and amplify the signal.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-breiman1984classification">
<p>Breiman, Leo, Jerome Friedman, Charles J Stone, and Richard A Olshen. 1984. <em>Classification and Regression Trees</em>. CRC Press.</p>
</div>
<div id="ref-fisher1958grouping">
<p>Fisher, Walter D. 1958. “On Grouping for Maximum Homogeneity.” <em>Journal of the American Statistical Association</em> 53 (284): 789–98.</p>
</div>
<div id="ref-ke2017lightgbm">
<p>Ke, Guolin, Qi Meng, Thomas Finley, Taifeng Wang, Wei Chen, Weidong Ma, Qiwei Ye, and Tie-Yan Liu. 2017. “Lightgbm: A Highly Efficient Gradient Boosting Decision Tree.” In <em>Advances in Neural Information Processing Systems</em>, 3146–54.</p>
</div>
<div id="ref-ke2015homogeneity">
<p>Ke, Zheng Tracy, Jianqing Fan, and Yichao Wu. 2015. “Homogeneity Pursuit.” <em>Journal of the American Statistical Association</em> 110 (509): 175–94.</p>
</div>
<div id="ref-lin2017ordered">
<p>Lin, You-Wu, Nan Xiao, Li-Li Wang, Chuan-Quan Li, and Qing-Song Xu. 2017. “Ordered Homogeneity Pursuit Lasso for Group Variable Selection with Applications to Spectroscopic Data.” <em>Chemometrics and Intelligent Laboratory Systems</em> 168: 62–71.</p>
</div>
<div id="ref-tibshirani2011solution">
<p>Tibshirani, Ryan J, Jonathan Taylor, and others. 2011. “The Solution Path of the Generalized Lasso.” <em>The Annals of Statistics</em> 39 (3): 1335–71.</p>
</div>
<div id="ref-zumel2016vtreat">
<p>Zumel, Nina, and John Mount. 2016. “vtreat: A Data.frame Processor for Predictive Modeling.” <em>arXiv Preprint arXiv:1611.09477</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nan Xiao.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
